<!DOCTYPE html PUBLIC "-//W3C//DTD XHTML 1.0 Transitional//EN" "http://www.w3.org/TR/xhtml1/DTD/xhtml1-transitional.dtd">
<html xmlns="http://www.w3.org/1999/xhtml">
<head>
<meta http-equiv="Content-Type" content="text/xhtml;charset=UTF-8"/>
<meta http-equiv="X-UA-Compatible" content="IE=9"/>
<meta name="generator" content="Doxygen 1.8.8"/>
<title>aura: README</title>
<link href="tabs.css" rel="stylesheet" type="text/css"/>
<script type="text/javascript" src="jquery.js"></script>
<script type="text/javascript" src="dynsections.js"></script>
<link href="navtree.css" rel="stylesheet" type="text/css"/>
<script type="text/javascript" src="resize.js"></script>
<script type="text/javascript" src="navtree.js"></script>
<script type="text/javascript">
  $(document).ready(initResizable);
  $(window).load(resizeHeight);
</script>
<link href="search/search.css" rel="stylesheet" type="text/css"/>
<script type="text/javascript" src="search/search.js"></script>
<script type="text/javascript">
  $(document).ready(function() { searchBox.OnSelectItem(0); });
</script>
<link href="doxygen.css" rel="stylesheet" type="text/css" />
</head>
<body>
<div id="top"><!-- do not remove this div, it is closed by doxygen! -->
<div id="titlearea">
<table cellspacing="0" cellpadding="0">
 <tbody>
 <tr style="height: 56px;">
  <td style="padding-left: 0.5em;">
   <div id="projectname">aura
   &#160;<span id="projectnumber">0.1</span>
   </div>
  </td>
 </tr>
 </tbody>
</table>
</div>
<!-- end header part -->
<!-- Generated by Doxygen 1.8.8 -->
<script type="text/javascript">
var searchBox = new SearchBox("searchBox", "search",false,'Search');
</script>
  <div id="navrow1" class="tabs">
    <ul class="tablist">
      <li><a href="index.html"><span>Main&#160;Page</span></a></li>
      <li class="current"><a href="pages.html"><span>Related&#160;Pages</span></a></li>
      <li><a href="modules.html"><span>Modules</span></a></li>
      <li><a href="annotated.html"><span>Data&#160;Structures</span></a></li>
      <li><a href="files.html"><span>Files</span></a></li>
      <li>
        <div id="MSearchBox" class="MSearchBoxInactive">
        <span class="left">
          <img id="MSearchSelect" src="search/mag_sel.png"
               onmouseover="return searchBox.OnSearchSelectShow()"
               onmouseout="return searchBox.OnSearchSelectHide()"
               alt=""/>
          <input type="text" id="MSearchField" value="Search" accesskey="S"
               onfocus="searchBox.OnSearchFieldFocus(true)" 
               onblur="searchBox.OnSearchFieldFocus(false)" 
               onkeyup="searchBox.OnSearchFieldChange(event)"/>
          </span><span class="right">
            <a id="MSearchClose" href="javascript:searchBox.CloseResultsWindow()"><img id="MSearchCloseImg" border="0" src="search/close.png" alt=""/></a>
          </span>
        </div>
      </li>
    </ul>
  </div>
</div><!-- top -->
<div id="side-nav" class="ui-resizable side-nav-resizable">
  <div id="nav-tree">
    <div id="nav-tree-contents">
      <div id="nav-sync" class="sync"></div>
    </div>
  </div>
  <div id="splitbar" style="-moz-user-select:none;" 
       class="ui-resizable-handle">
  </div>
</div>
<script type="text/javascript">
$(document).ready(function(){initNavTree('md_README.html','');});
</script>
<div id="doc-content">
<!-- window showing the filter options -->
<div id="MSearchSelectWindow"
     onmouseover="return searchBox.OnSearchSelectShow()"
     onmouseout="return searchBox.OnSearchSelectHide()"
     onkeydown="return searchBox.OnSearchSelectKey(event)">
<a class="SelectItem" href="javascript:void(0)" onclick="searchBox.OnSelectItem(0)"><span class="SelectionMark">&#160;</span>All</a><a class="SelectItem" href="javascript:void(0)" onclick="searchBox.OnSelectItem(1)"><span class="SelectionMark">&#160;</span>Data Structures</a><a class="SelectItem" href="javascript:void(0)" onclick="searchBox.OnSelectItem(2)"><span class="SelectionMark">&#160;</span>Functions</a><a class="SelectItem" href="javascript:void(0)" onclick="searchBox.OnSelectItem(3)"><span class="SelectionMark">&#160;</span>Variables</a><a class="SelectItem" href="javascript:void(0)" onclick="searchBox.OnSelectItem(4)"><span class="SelectionMark">&#160;</span>Modules</a><a class="SelectItem" href="javascript:void(0)" onclick="searchBox.OnSelectItem(5)"><span class="SelectionMark">&#160;</span>Pages</a></div>

<!-- iframe showing the search results (closed by default) -->
<div id="MSearchResultsWindow">
<iframe src="javascript:void(0)" frameborder="0" 
        name="MSearchResults" id="MSearchResults">
</iframe>
</div>

<div class="header">
  <div class="headertitle">
<div class="title">README </div>  </div>
</div><!--header-->
<div class="contents">
<div class="textblock"><table class="doxtable">
<tr>
<th><b>Travis CI (Core Unit Tests)</b> </th><th><b>Jenkins (transports, real hardware )</b>  </th></tr>
<tr>
<td><a href="https://travis-ci.org/nekromant/aura">![Build Status](https://travis-ci.org/nekromant/aura.svg?branch=master)</a> </td><td><a href="https://jenkins.ncrmnt.org/job/GithubCI/job/aura/">![Build Status](https://jenkins.ncrmnt.org/job/GithubCI/job/aura/badge/icon?ts=1)</a> </td></tr>
</table>
<h1>AURA: Another Universal RPC, Actually</h1>
<p>Aura is a simple and fast universal RPC library that allows you to quickly interface with your favourite hardware without reinventing the wheel. Unlike most of the RPC libraries, it is designed to link you to simple embedded devices and take care of their weirdness, namely:</p>
<ul>
<li>It does all the job serializing and deserializing data, taking all the care of foreign endianness</li>
<li>It doesn't use any complex data formats (e.g. XML) that some 8-bit avr will have a hard time parsing.</li>
<li>Remote 'nodes' can go offline and online multiple times and it's not an error (unless you want it to be)</li>
<li>Remote 'nodes' can even go offline and come back online with a different set of exported functions. And it still will not be an error, unless you want it to be.</li>
<li>Aura provides hooks to override memory allocation, allowing you to interface with DSPs that require a special memory allocation technique for performance reasons, e.g. ION Memory Manager. And it allows you to avoid needless copying of serialized data. e.g. zero-copy</li>
<li>Provides both sync and async API</li>
<li>Written in pure C with as little dependencies as possible</li>
<li>Has lua bindings (Want your favourite language supported as well - roll up the sleeves and contribute!)</li>
<li>OpenSource</li>
</ul>
<h1>TL; DR (In C, Sync API)</h1>
<p>```C int main() { int ret; struct aura_node *n = aura_open("dummy", NULL); aura_wait_status(n, AURA_STATUS_ONLINE); // Beware of TOCTOU! See docs! struct <a class="el" href="structaura__buffer.html">aura_buffer</a> *retbuf;</p>
<p>ret = aura_call(n, "echo_u16", &amp;retbuf, 0x0102); //echo_u16 is a method on a remote device if (ret == 0) { uint16_t rt = aura_buffer_get_u16(retbuf); aura_buffer_release(n, retbuf); printf("Call result: %d\n", rt) } aura_close(n); return 0; } ```</p>
<h1>TL; DR - 2 (In LUA, Sync API)</h1>
<p>```lua aura = require("aura"); node = aura.open("dummy", "blah"); aura.wait_status(node, aura.STATUS_ONLINE); print(node:echo_u8(5))</p>
<p>```</p>
<p>For async examples see tests and docs.</p>
<h1>Installation</h1>
<p>You'll need cmake, lua5.2-dev, libusb-1.0 and easynmc-0.1.1 (For NeuroMatrix Transport).</p>
<p>``` sudo apt-get install build-essential cmake lua5.2-dev libusb-1.0 easynmc-0.1.1 mkdir build cd build cmake .. -DCMAKE_INSTALL_PREFIX=/usr make sudo make install ```</p>
<p>Or just build yourself a debian package with ``` dpkg-buildpackage ```</p>
<h1>Terminology</h1>
<p>Aura runs on a 'host machine'. E.g. Your laptop, Raspberry PI, OpenWRT router. Anything with a recent linux ditro would do just fine.</p>
<p>Aura connects to different devices called 'nodes' via some transport. As you might've guessed this needs a transport plugin. A full list of available plugins is somewhere below in this file.</p>
<p>When going online a node reports (in a transport-specific way) about stuff it has. It is called an and aura fills in an 'export table'. Export table is just a list of objects that a node 'exports'.</p>
<p>Each object can be either a 'method' or 'event'. It is identified by it's name and a numeric id that is used internally to issue a call.</p>
<p>A 'method' is just your good old RPC call, like:</p>
<p>result1, result2 = node.mymethod(arg1, arg2);</p>
<p>Host issues all method calls.</p>
<p>'Events' on the other hand are issued by a remote node. Normally you would want to use the async API for that!</p>
<p>Basically that's all you need to know. More details in the doxygen docs.</p>
<h1>Pull request checklist.</h1>
<p>Before pull-requesting, please:</p>
<ul>
<li>Run static analysis on all of your code. Use facebook infer, clang-analyze and cppcheck. ALL OF THEM! They all all tend to find different things.</li>
<li>If you've messed with aura core - run all of the test suite under valgrind to make sure no memory is leaking whatsoever. e.g.</li>
</ul>
<p>``` mkdir build cd build cmake .. make test make ExperimatalMemcheck ```</p>
<ul>
<li>If you are adding a new transport - don't be lazy to add unit tests and some doxygen documentation.</li>
<li>Transport plugin options and docs</li>
</ul>
<p>All transport accept parameters as a string. The format of the string depends on the transport.</p>
<h1>Available transports:</h1>
<ul>
<li>dummy - A dummy transport for unit tests. We love unit-tests. Nuff said!</li>
<li>sysfs-gpio - A 'transport' that allows you to control host PC GPIO lines using the sysfs interface. Should serve as a more complex transport plugin example.</li>
<li>susb - A simple usb transport that does control transfers to a usb device according to a config file. Using this one you can interface with simplest possible USB devices that have no flash for any other logic. Doesn't support events. Needs lua, since the configuration file for it is just a lua script.</li>
<li>usb - A more complex transport over USB. Supports events and methods, reads the information from the target device</li>
<li>nmc - NeuroMatrix DSP transport. Requires experimental Easynmc Framework and ION Memory Manager. Aura must be running on a SoC equipped with a NeuroMatrix DSP, e.g. K1879ХБ1Я.</li>
</ul>
<p>Want more? Contribute!</p>
<h2>simpleusb (a.k.a. susb)</h2>
<p>simpleusb transport maps control transfers to methods. Simple as that. No events whatsoever. All methods require at least two arguments. wValue and wIndex (See USB spec). The transport accepts a path to the configuration file as it's option.</p>
<p>A typical configuration file may look like this:</p>
<p>```lua device = { vid = 0x1d50; pid = 0x6032; vendor = "www.ncrmnt.org"; product = "aura-susb-test-rig"; &ndash;serial = "blah"; methods = { [0] = NONE("led_ctl"), [1] = NONE("blink"), [2] = READ("read", UINT32, UINT32), [3] = WRITE("write", UINT32, UINT32), }; }</p>
<p>return device ```</p>
<p>The config above describes 4 methods:</p>
<p>``` &mdash; Dumping export table &mdash; 0. METHOD led_ctl( uint16_t uint16_t ) [out 4 bytes] | [in 0 bytes]</p><ol type="1">
<li>METHOD blink( uint16_t uint16_t ) [out 4 bytes] | [in 0 bytes]</li>
<li>METHOD uint32_t uint32_t read( uint16_t uint16_t ) [out 12 bytes] | [in 8 bytes]</li>
<li>METHOD write( uint16_t uint16_t uint32_t uint32_t ) [out 12 bytes] | [in 0 bytes] ----------&mdash;8&lt;----------&mdash;</li>
</ol>
<p>```</p>
<p>vendor, product and serial strings can be omited. If so the transport will match any.</p>
<p>NONE stands for a control packet with no data phase.</p>
<p>READ stands for <em>surprise</em> reading data from device</p>
<p>WRITE stands for writing data to device</p>
<p>Your hardware should pack the data without any padding between fields. E.g. Use <b>attribute</b>(("packed")) for your structs in firmware.</p>
<p>N.B.</p>
<p>VUSB-based devices (or libusb?) do not seem to play nicely when we have the setup packet only with no data part. Transfers may fail instantly at random without any data delivered. A typical run at my box gives:</p>
<p>9122 succeeded, 878 failed total 10000</p>
<p>The distribution of failures is more or less even. See tests-transports/test-susb-stability-none</p>
<p>Adding just one byte of data to the packet fix the issue. Posible workarounds here are:</p>
<ol type="1">
<li>Retry N times</li>
<li>Add just one dummy byte for the transfer</li>
</ol>
<p>Since nobody reported this workaround breaking support for their hardware (yet!) - we'll do it the second way. For now.</p>
<h2>usb</h2>
<p>This is a full-blown aura RPC over the usb bus with events. The transport's option string looks like this:</p>
<p>"1d50:6032;vendorstring;productstring;serial"</p>
<p>To match <em>ANY</em> serial, product, vendor:</p>
<p>"1d50:6032;;;"</p>
<h2>nmc</h2>
<p>You can use this transport to call remote methods running on RC Module's NeuroMatrix DSP core. This transport requires that you run it on a SoC with NeuroMatrix DSP and experimental easynmc driver, e.g. K1879ХБ1Я. </p>
</div></div><!-- contents -->
</div><!-- doc-content -->
<!-- start footer part -->
<div id="nav-path" class="navpath"><!-- id is needed for treeview function! -->
  <ul>
    <li class="footer">Generated on Tue Mar 29 2016 22:49:28 for aura by
    <a href="http://www.doxygen.org/index.html">
    <img class="footer" src="doxygen.png" alt="doxygen"/></a> 1.8.8 </li>
  </ul>
</div>
</body>
</html>
